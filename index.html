<!DOCTYPE html>
<html lang="it">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QDPZQGQVPH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QDPZQGQVPH');
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guess the angle</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: #121212;
        color: #e0e0e0;
      }
      
      canvas {
        margin: 20px;
        border-radius: 10px;
        width: 400px;
        height: 400px;
        background-color: #1e1e1e; 
      }
      
      #main-title {
        color: #e0e0e0; 
        font-size: 40px;
        font-weight: bolder;
        font-family: Georgia, serif;
      }
      
      #bar {
        height: auto;
        width: 400px;
        display: flex;
        justify-content: space-evenly;
      }
      
      #bar button {
        width: 70px;
        border-radius: 15px;
        background-color: #333; 
        color: #e0e0e0;
        border: 1px solid #444;
      }
      
      #bar input {
        border-radius: 15px;
        width: 220px;
        background-color: #333;
        color: #e0e0e0; 
        border: 1px solid #444;
      }
      
      p {
        font-family: Georgia, serif;
        color: #e0e0e0; 
      }
      
      table {
        margin: 20px;
        border-collapse: collapse;
        width: 300px;
        text-align: center;
        background-color: #1e1e1e;
      }
      
      th, td {
        padding: 3px;
        border: 1px solid #444;
        color: #e0e0e0;
      }
      
      .arrow-up {
        color: #00aaff;
        font-size: 1.5em;
      }
      
      .success {
        color: #ffcc00;
        font-size: 1.5em;
      }
      
      .cold {
        color: #00aaff;
      }

      .hot {
        color: #ffcc00;
        font-size: 1.3em;
      }
      
      .boiling {
        color: #ff4500;
        font-size: 1.5em;
      }
      
      .emoji-win {
        font-size: 1.5em;
        color: #d14fe2;
      }
      
      #play-again {
        width: 130px;
        height: 50px;
        border-radius: 15px;
        background-color: #333; 
        color: #e0e0e0; 
        border: 1px solid #444;
      }

      #rules-button {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        background-color: #333;
        border: none;
        border-radius: 50%;
        color: #fff;
        font-size: 1.5em;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
      }

      #rules-button:hover {
        background-color: #333;
      }

      #popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        padding: 20px;
        background-color: #1e1e1e;
        border: 2px solid #333;
        border-radius: 10px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.6);
        z-index: 1000;
        color: #fff;
        text-align: center;
      }

      #popup h3 {
        margin-top: 0;
      }

      #popup button {
        margin-top: 15px;
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }

      #popup button:hover {
        background-color: #333;
      }

      #overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
      
      @media only screen and (max-width: 600px) {
        canvas {
          width: 200px;
          height: 200px; 
          background-color: #1e1e1e;
        }
      
        #main-title {
          font-size: 30px; 
        }
      
        #bar {
          width: 200px; 
        }
      
        #bar button {
          width: 60px; 
        }
      
        #bar input {
          width: 120px;
        }
      
        table {
          width: 200px;
        }
      
        #play-again {
          width: 100px;
          height: 40px;
        }
      }
    </style>
  </head>

  <body>
    <p id="main-title">Guess the angle</p>

    <canvas id="angleCanvas" width="400" height="400"></canvas>

    <div id="bar">
      <input type="number" id="guessInput" placeholder="Input here..." onkeypress="if(event.key === 'Enter'){makeGuess();}" />
      <button onclick="makeGuess()">Try</button>
      <p>
        <span id="attempts">0</span>/4
      </p>
    </div>

    <div id="guess">
      <table>
        <tbody id="guessTableBody">
          <!-- Righe dinamiche dei tentativi verranno aggiunte qui -->
        </tbody>
      </table>
    </div>

    <button id="play-again" onclick="startNewGame()">Play again</button>

    <button id="rules-button" onclick="showPopup()">?</button>

    <div id="overlay"></div>

    <div id="popup">
      <h3>Game rules:</h3>
      <p>
        1. You have to guess the angle<br />
        2. You have 4 tries<br />
        3. The feedback will tell you<br>
        how far are you from perfection:<br>
        - Cold: more than 15 deg far<br>
        - Hot: less than 15 deg far<br>
        - Boiling: 4 deg near
      </p>
      <button onclick="closePopup()">Close</button>
    </div>
    
    <script>
      const canvas = document.getElementById('angleCanvas')
      const ctx = canvas.getContext('2d')
      const canvasCenterX = canvas.width / 2
      const canvasCenterY = canvas.height / 2
      let randomAngle, attempts
      const guessTableBody = document.getElementById('guessTableBody')
      const playAgainButton = document.getElementById('play-again')

      function showPopup() {
        document.getElementById('popup').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
      }

      function closePopup() {
        document.getElementById('popup').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
      }

      function initializeGame() {
        randomAngle = Math.floor(Math.random() * 361)
        attempts = 0
        document.getElementById('attempts').textContent = attempts
        guessTableBody.innerHTML = ''
        drawAngle(randomAngle)
        playAgainButton.style.display = 'none'
      }
      
      function drawAngle(angle) {
        ctx.clearRect(0, 0, canvas.width, canvas.height)
      
        // Ricalcola il centro del canvas in caso di ridimensionamento
        const canvasCenterX = canvas.width / 2
        const canvasCenterY = canvas.height / 2
      
        const lineLength = 150
        const startAngle = Math.random() * 2 * Math.PI
      
        const x1 = canvasCenterX + lineLength * Math.cos(startAngle)
        const y1 = canvasCenterY + lineLength * Math.sin(startAngle)
      
        const x2 = canvasCenterX + lineLength * Math.cos(startAngle + (angle * Math.PI) / 180)
        const y2 = canvasCenterY + lineLength * Math.sin(startAngle + (angle * Math.PI) / 180)
      
        ctx.beginPath()
        ctx.moveTo(canvasCenterX, canvasCenterY)
        ctx.strokeStyle = 'white'
        ctx.lineWidth = 3
        ctx.lineTo(x1, y1)
        ctx.stroke()
      
        ctx.beginPath()
        ctx.moveTo(canvasCenterX, canvasCenterY)
        ctx.strokeStyle = 'white'
        ctx.lineWidth = 3
        ctx.lineTo(x2, y2)
        ctx.stroke()
      
        ctx.beginPath()
        ctx.arc(canvasCenterX, canvasCenterY, 50, startAngle, startAngle + (angle * Math.PI) / 180, false)
        ctx.strokeStyle = 'yellow'
        ctx.lineWidth = 2
        ctx.stroke()
      }
      
      function makeGuess() {
        const guessInput = document.getElementById('guessInput')
        const guess = parseInt(guessInput.value)
      
        if (isNaN(guess) || guess < 0 || guess > 360) {
          const newRow = `<tr><td colspan="3">Number must be between 0 and 360</td></tr>`
          guessTableBody.innerHTML += newRow
          return
        }
      
        attempts++
        document.getElementById('attempts').textContent = attempts
      
        const diff = Math.abs(guess - randomAngle)
        let feedbackMessage = ''
        let direction = ''
      
        if (guess < randomAngle) {
          direction = `<span class="arrow-up">&#8593;</span>`
        } else if (guess > randomAngle) {
          direction = `<span class="arrow-up">&#8595;</span>`
        } else {
          direction = `<span class="emoji-win">&#127881;</span>`
        }
      
        if (diff === 0) {
          feedbackMessage = `<span class="emoji-win">You Won! &#127881;</span>`
          endGame()
        } else if (diff <= 4) {
          feedbackMessage = `<span class="boiling">Boiling! &#128293;</span>`
        } else if (diff <= 15) {
          feedbackMessage = `<span class="hot">Hot! &#9728;</span>`
        } else {
          feedbackMessage = `<span class="cold">Cold! &#10052;</span>`
        }
      
        const newRow = `<tr><td>${guess}Â°</td><td>${direction}</td><td>${feedbackMessage}</td></tr>`
        guessTableBody.innerHTML += newRow
      
        if (attempts === 4 && diff !== 0) {
          const gameOverRow = `<tr><td colspan="3">Missed opportunity, angle was ${randomAngle}.</td></tr>`
          guessTableBody.innerHTML += gameOverRow
          endGame()
        }
      
        guessInput.value = ''
      }
      
      function endGame() {
        playAgainButton.style.display = 'block'
      }
      
      function startNewGame() {
        initializeGame()
      }

      initializeGame()
    </script>
  </body>
</html>
